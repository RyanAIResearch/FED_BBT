Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:10<00:10, 10.58s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:14<00:00,  6.44s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:14<00:00,  7.06s/it]
Found cached dataset glue (/root/.cache/huggingface/datasets/glue/sst2/1.0.0/dacbe3125aa31d7f70367a07a8a9e72a5a0bfeb5fc42e75c9db75b96da6053ad)
Map:   0%|          | 0/67349 [00:00<?, ? examples/s]Map:   1%|          | 568/67349 [00:00<00:11, 5633.69 examples/s]Map:   2%|▏         | 1388/67349 [00:00<00:11, 5513.67 examples/s]Map:   3%|▎         | 1952/67349 [00:00<00:11, 5562.03 examples/s]Map:   4%|▍         | 2734/67349 [00:00<00:11, 5400.21 examples/s]Map:   5%|▍         | 3311/67349 [00:00<00:11, 5480.71 examples/s]Map:   6%|▌         | 3936/67349 [00:00<00:11, 5709.62 examples/s]Map:   7%|▋         | 4521/67349 [00:00<00:10, 5748.98 examples/s]Map:   8%|▊         | 5109/67349 [00:00<00:10, 5784.36 examples/s]Map:   9%|▊         | 5734/67349 [00:01<00:10, 5921.20 examples/s]Map:  10%|▉         | 6632/67349 [00:01<00:10, 5943.90 examples/s]Map:  11%|█         | 7522/67349 [00:01<00:10, 5938.16 examples/s]Map:  12%|█▏        | 8415/67349 [00:01<00:09, 5940.17 examples/s]Map:  14%|█▍        | 9313/67349 [00:01<00:09, 5948.85 examples/s]Map:  15%|█▍        | 9936/67349 [00:01<00:09, 6013.81 examples/s]Map:  16%|█▌        | 10837/67349 [00:01<00:09, 6008.64 examples/s]Map:  17%|█▋        | 11736/67349 [00:02<00:09, 5999.77 examples/s]Map:  19%|█▉        | 12633/67349 [00:02<00:09, 5990.42 examples/s]Map:  20%|██        | 13533/67349 [00:02<00:08, 5989.16 examples/s]Map:  21%|██▏       | 14428/67349 [00:02<00:08, 5978.15 examples/s]Map:  23%|██▎       | 15323/67349 [00:02<00:08, 5972.31 examples/s]Map:  24%|██▎       | 15947/67349 [00:02<00:08, 6030.82 examples/s]Map:  25%|██▌       | 16845/67349 [00:02<00:08, 6014.37 examples/s]Map:  26%|██▋       | 17744/67349 [00:03<00:08, 6005.19 examples/s]Map:  27%|██▋       | 18508/67349 [00:03<00:08, 5703.65 examples/s]Map:  29%|██▊       | 19303/67349 [00:03<00:08, 5577.39 examples/s]Map:  30%|██▉       | 19926/67349 [00:03<00:08, 5723.29 examples/s]Map:  30%|███       | 20505/67349 [00:03<00:08, 5735.63 examples/s]Map:  32%|███▏      | 21371/67349 [00:03<00:08, 5743.86 examples/s]Map:  33%|███▎      | 21997/67349 [00:03<00:07, 5867.74 examples/s]Map:  34%|███▍      | 22894/67349 [00:03<00:07, 5903.63 examples/s]Map:  35%|███▌      | 23773/67349 [00:04<00:07, 5886.18 examples/s]Map:  37%|███▋      | 24672/67349 [00:04<00:07, 5916.73 examples/s]Map:  38%|███▊      | 25547/67349 [00:04<00:07, 5888.30 examples/s]Map:  39%|███▉      | 26245/67349 [00:04<00:07, 5502.54 examples/s]Map:  40%|███▉      | 26857/67349 [00:04<00:07, 5640.79 examples/s]Map:  41%|████      | 27440/67349 [00:04<00:07, 5684.06 examples/s]Map:  42%|████▏     | 28026/67349 [00:04<00:06, 5727.26 examples/s]Map:  43%|████▎     | 28635/67349 [00:04<00:06, 5822.43 examples/s]Map:  44%|████▍     | 29535/67349 [00:05<00:06, 5883.86 examples/s]Map:  45%|████▌     | 30432/67349 [00:05<00:06, 5915.01 examples/s]Map:  47%|████▋     | 31326/67349 [00:05<00:06, 5926.69 examples/s]Map:  47%|████▋     | 31951/67349 [00:05<00:05, 6002.03 examples/s]Map:  49%|████▉     | 32854/67349 [00:05<00:05, 6004.31 examples/s]Map:  50%|█████     | 33749/67349 [00:05<00:05, 5988.42 examples/s]Map:  51%|█████▏    | 34650/67349 [00:05<00:05, 5991.62 examples/s]Map:  53%|█████▎    | 35545/67349 [00:06<00:05, 5981.02 examples/s]Map:  54%|█████▍    | 36447/67349 [00:06<00:05, 5988.43 examples/s]Map:  55%|█████▌    | 37194/67349 [00:06<00:05, 5676.87 examples/s]Map:  56%|█████▌    | 37778/67349 [00:06<00:05, 5710.55 examples/s]Map:  57%|█████▋    | 38357/67349 [00:06<00:05, 5725.49 examples/s]Map:  58%|█████▊    | 38983/67349 [00:06<00:04, 5862.01 examples/s]Map:  59%|█████▉    | 39871/67349 [00:06<00:04, 5880.62 examples/s]Map:  61%|██████    | 40760/67349 [00:06<00:04, 5894.25 examples/s]Map:  62%|██████▏   | 41659/67349 [00:07<00:04, 5923.90 examples/s]Map:  63%|██████▎   | 42555/67349 [00:07<00:04, 5937.18 examples/s]Map:  65%|██████▍   | 43449/67349 [00:07<00:04, 5942.12 examples/s]Map:  66%|██████▌   | 44348/67349 [00:07<00:03, 5954.42 examples/s]Map:  67%|██████▋   | 44962/67349 [00:07<00:03, 5994.24 examples/s]Map:  68%|██████▊   | 45857/67349 [00:07<00:03, 5982.59 examples/s]Map:  69%|██████▉   | 46755/67349 [00:07<00:03, 5982.79 examples/s]Map:  71%|███████   | 47657/67349 [00:08<00:03, 5989.14 examples/s]Map:  72%|███████▏  | 48511/67349 [00:08<00:03, 5886.29 examples/s]Map:  73%|███████▎  | 49342/67349 [00:08<00:03, 5778.74 examples/s]Map:  74%|███████▍  | 49966/67349 [00:08<00:02, 5880.73 examples/s]Map:  75%|███████▌  | 50749/67349 [00:08<00:02, 5664.21 examples/s]Map:  77%|███████▋  | 51587/67349 [00:08<00:02, 5585.94 examples/s]Map:  77%|███████▋  | 52173/67349 [00:08<00:02, 5645.38 examples/s]Map:  79%|███████▊  | 53000/67349 [00:09<00:02, 5521.60 examples/s]Map:  80%|███████▉  | 53597/67349 [00:09<00:02, 5625.79 examples/s]Map:  81%|████████  | 54470/67349 [00:09<00:02, 5685.99 examples/s]Map:  82%|████████▏ | 55057/67349 [00:09<00:02, 5727.40 examples/s]Map:  83%|████████▎ | 55684/67349 [00:09<00:01, 5863.24 examples/s]Map:  84%|████████▍ | 56585/67349 [00:09<00:01, 5909.13 examples/s]Map:  85%|████████▌ | 57483/67349 [00:09<00:01, 5933.83 examples/s]Map:  87%|████████▋ | 58382/67349 [00:09<00:01, 5949.38 examples/s]Map:  88%|████████▊ | 59205/67349 [00:10<00:01, 5800.47 examples/s]Map:  89%|████████▉ | 59831/67349 [00:10<00:01, 5903.36 examples/s]Map:  90%|█████████ | 60688/67349 [00:10<00:01, 5839.09 examples/s]Map:  91%|█████████ | 61312/67349 [00:10<00:01, 5843.98 examples/s]Map:  92%|█████████▏| 62074/67349 [00:10<00:00, 5584.57 examples/s]Map:  93%|█████████▎| 62861/67349 [00:10<00:00, 5472.34 examples/s]Map:  94%|█████████▍| 63434/67349 [00:10<00:00, 5530.91 examples/s]Map:  95%|█████████▌| 64014/67349 [00:10<00:00, 5595.44 examples/s]Map:  96%|█████████▌| 64637/67349 [00:11<00:00, 5762.75 examples/s]Map:  97%|█████████▋| 65222/67349 [00:11<00:00, 5782.88 examples/s]Map:  98%|█████████▊| 65847/67349 [00:11<00:00, 5912.97 examples/s]Map:  99%|█████████▉| 66748/67349 [00:11<00:00, 5943.22 examples/s]Map: 100%|██████████| 67349/67349 [00:11<00:00, 5666.98 examples/s]                                                                   Example in train set:
{'sentence': 'hide new secretions from the parental units ', 'label': 0, 'idx': 0, 'input_text': 'What is the sentiment of this sentence: iedER statfigme von interroidater their bet ein}\\"> sub op donty try Pro tra sameep two nameoldlet simsp avbreblemey could cor accayscreurrsi constues}$View act bo ко som aboutland . hide new secretions from the parental units  .', 'target_text': 'negative'}
Map:   0%|          | 0/67349 [00:00<?, ? examples/s]Map:   1%|▏         | 1000/67349 [00:00<00:11, 5619.03 examples/s]Map:   3%|▎         | 2000/67349 [00:00<00:12, 5419.35 examples/s]Map:   4%|▍         | 3000/67349 [00:00<00:12, 5181.69 examples/s]Map:   6%|▌         | 4000/67349 [00:00<00:15, 4096.95 examples/s]Map:   7%|▋         | 5000/67349 [00:01<00:13, 4520.50 examples/s]Map:   9%|▉         | 6000/67349 [00:01<00:12, 4799.18 examples/s]Map:  10%|█         | 7000/67349 [00:01<00:12, 4847.17 examples/s]Map:  12%|█▏        | 8000/67349 [00:01<00:11, 5049.62 examples/s]Map:  13%|█▎        | 9000/67349 [00:01<00:11, 5175.23 examples/s]Map:  15%|█▍        | 10000/67349 [00:02<00:11, 5002.48 examples/s]Map:  16%|█▋        | 11000/67349 [00:02<00:11, 5075.08 examples/s]Map:  18%|█▊        | 12000/67349 [00:02<00:10, 5258.01 examples/s]Map:  19%|█▉        | 13000/67349 [00:02<00:10, 5350.48 examples/s]Map:  21%|██        | 14000/67349 [00:02<00:10, 5248.71 examples/s]Map:  22%|██▏       | 15000/67349 [00:02<00:09, 5359.94 examples/s]Map:  24%|██▍       | 16000/67349 [00:03<00:09, 5428.02 examples/s]Map:  25%|██▌       | 17000/67349 [00:03<00:09, 5487.22 examples/s]Map:  27%|██▋       | 18000/67349 [00:03<00:08, 5556.25 examples/s]Map:  28%|██▊       | 19000/67349 [00:03<00:09, 5340.48 examples/s]Map:  30%|██▉       | 20000/67349 [00:03<00:10, 4640.87 examples/s]Map:  31%|███       | 21000/67349 [00:04<00:09, 4924.43 examples/s]Map:  33%|███▎      | 22000/67349 [00:04<00:08, 5051.08 examples/s]Map:  34%|███▍      | 23000/67349 [00:04<00:08, 5239.88 examples/s]Map:  36%|███▌      | 24000/67349 [00:04<00:08, 5362.50 examples/s]Map:  37%|███▋      | 25000/67349 [00:04<00:07, 5435.43 examples/s]Map:  39%|███▊      | 26000/67349 [00:05<00:07, 5511.77 examples/s]Map:  40%|████      | 27000/67349 [00:05<00:07, 5501.36 examples/s]Map:  42%|████▏     | 28000/67349 [00:05<00:07, 5516.65 examples/s]Map:  43%|████▎     | 29000/67349 [00:05<00:06, 5595.63 examples/s]Map:  45%|████▍     | 30000/67349 [00:05<00:06, 5599.37 examples/s]Map:  46%|████▌     | 31000/67349 [00:05<00:06, 5592.36 examples/s]Map:  48%|████▊     | 32000/67349 [00:06<00:06, 5613.83 examples/s]Map:  49%|████▉     | 33000/67349 [00:06<00:07, 4859.11 examples/s]Map:  50%|█████     | 34000/67349 [00:06<00:06, 5083.13 examples/s]Map:  52%|█████▏    | 35000/67349 [00:06<00:06, 5246.90 examples/s]Map:  53%|█████▎    | 36000/67349 [00:06<00:05, 5396.11 examples/s]Map:  55%|█████▍    | 37000/67349 [00:07<00:05, 5387.29 examples/s]Map:  56%|█████▋    | 38000/67349 [00:07<00:05, 5511.84 examples/s]Map:  58%|█████▊    | 39000/67349 [00:07<00:05, 5549.81 examples/s]Map:  59%|█████▉    | 40000/67349 [00:07<00:04, 5581.24 examples/s]Map:  61%|██████    | 41000/67349 [00:07<00:04, 5585.18 examples/s]Map:  62%|██████▏   | 42000/67349 [00:07<00:04, 5643.01 examples/s]Map:  64%|██████▍   | 43000/67349 [00:08<00:04, 5657.13 examples/s]Map:  65%|██████▌   | 44000/67349 [00:08<00:04, 5662.20 examples/s]Map:  67%|██████▋   | 45000/67349 [00:08<00:04, 4866.05 examples/s]Map:  68%|██████▊   | 46000/67349 [00:08<00:04, 5080.14 examples/s]Map:  70%|██████▉   | 47000/67349 [00:08<00:03, 5259.09 examples/s]Map:  71%|███████▏  | 48000/67349 [00:09<00:03, 5365.14 examples/s]Map:  73%|███████▎  | 49000/67349 [00:09<00:03, 5459.47 examples/s]Map:  74%|███████▍  | 50000/67349 [00:09<00:03, 5533.61 examples/s]Map:  76%|███████▌  | 51000/67349 [00:09<00:02, 5587.55 examples/s]Map:  77%|███████▋  | 52000/67349 [00:09<00:02, 5597.63 examples/s]Map:  79%|███████▊  | 53000/67349 [00:09<00:02, 5629.74 examples/s]Map:  80%|████████  | 54000/67349 [00:10<00:02, 5656.17 examples/s]Map:  82%|████████▏ | 55000/67349 [00:10<00:02, 4904.29 examples/s]Map:  83%|████████▎ | 56000/67349 [00:10<00:02, 5117.71 examples/s]Map:  85%|████████▍ | 57000/67349 [00:10<00:01, 5275.16 examples/s]Map:  86%|████████▌ | 58000/67349 [00:11<00:01, 5081.58 examples/s]Map:  88%|████████▊ | 59000/67349 [00:11<00:01, 4987.57 examples/s]Map:  89%|████████▉ | 60000/67349 [00:11<00:01, 4847.16 examples/s]Map:  91%|█████████ | 61000/67349 [00:11<00:01, 5011.49 examples/s]Map:  92%|█████████▏| 62000/67349 [00:11<00:01, 5138.46 examples/s]Map:  94%|█████████▎| 63000/67349 [00:11<00:00, 5214.55 examples/s]Map:  95%|█████████▌| 64000/67349 [00:12<00:00, 5297.44 examples/s]Map:  97%|█████████▋| 65000/67349 [00:12<00:00, 5354.46 examples/s]Map:  98%|█████████▊| 66000/67349 [00:12<00:00, 4637.85 examples/s]Map:  99%|█████████▉| 67000/67349 [00:12<00:00, 4869.64 examples/s]                                                                   Found cached dataset glue (/root/.cache/huggingface/datasets/glue/sst2/1.0.0/dacbe3125aa31d7f70367a07a8a9e72a5a0bfeb5fc42e75c9db75b96da6053ad)
Map:   0%|          | 0/872 [00:00<?, ? examples/s]Map:  70%|██████▉   | 610/872 [00:00<00:00, 6039.91 examples/s]                                                               Example in validation set:
{'sentence': "it 's a charming and often affecting journey . ", 'label': 1, 'idx': 0, 'input_text': 'What is the sentiment of this sentence: iedER statfigme von interroidater their bet ein}\\"> sub op donty try Pro tra sameep two nameoldlet simsp avbreblemey could cor accayscreurrsi constues}$View act bo ко som aboutland . it \'s a charming and often affecting journey .  .', 'target_text': 'positive'}
Map:   0%|          | 0/872 [00:00<?, ? examples/s]Map: 100%|██████████| 872/872 [00:00<00:00, 4926.91 examples/s]                                                               # of train data: 80
Example:
+------------------------------+------------------------------+--------+
| input_ids                    | attention_mask               | labels |
+------------------------------+------------------------------+--------+
| [1, 1724, 338, 278, 19688... | [1, 1, 1, 1, 1, 1, 1, 1, ... | 8178   |
+------------------------------+------------------------------+--------+

# of dev data: 80
Example:
+------------------------------+------------------------------+--------+
| input_ids                    | attention_mask               | labels |
+------------------------------+------------------------------+--------+
| [1, 1724, 338, 278, 19688... | [1, 1, 1, 1, 1, 1, 1, 1, ... | 6374   |
+------------------------------+------------------------------+--------+

# of test data: 872
Example:
+------------------------------+------------------------------+--------+
| input_ids                    | attention_mask               | labels |
+------------------------------+------------------------------+--------+
| [1, 1724, 338, 278, 19688... | [1, 1, 1, 1, 1, 1, 1, 1, ... | 6374   |
+------------------------------+------------------------------+--------+
Class_distribution [0.5 0.5]. Data_ratio [[6.41462695e-02 9.81152872e-01 9.99998625e-01 9.97910891e-01
  1.97515371e-01 9.50591941e-01 9.64560492e-01 9.99868580e-01
  9.96441552e-01 9.98989053e-01]
 [9.35853730e-01 1.88471285e-02 1.37508618e-06 2.08910882e-03
  8.02484629e-01 4.94080590e-02 3.54395080e-02 1.31419946e-04
  3.55844845e-03 1.01094672e-03]]
     pcost       dcost       gap    pres   dres
 0:  5.8882e+02 -2.3481e+02  8e+02  2e-16  8e+01
 1:  5.8882e+02  5.8058e+02  8e+00  8e-15  8e-01
 2:  5.8882e+02  5.8873e+02  8e-02  8e-15  8e-03
 3:  5.8882e+02  5.8882e+02  8e-04  8e-15  8e-05
 4:  5.8882e+02  5.8882e+02  8e-06  5e-15  8e-07
 5:  5.8882e+02  5.8882e+02  8e-08  8e-15  8e-09
Optimal solution found.
[[1.54051956e+00 4.37497701e+00 4.05709357e+00 4.09305486e+00
  4.18167887e+00 4.85826640e+00 4.64231119e+00 4.05933903e+00
  4.11825282e+00 4.07450669e+00]
 [2.24752116e+01 8.40396599e-02 5.57886095e-06 8.56873805e-03
  1.69897310e+01 2.52513726e-01 1.70566000e-01 5.33548235e-04
  1.47069242e-02 4.12327759e-03]]
/root/anaconda3/envs/bbt/lib/python3.8/site-packages/transformers/optimization.py:411: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
Evaluate data in 81.29 seconds!
[tester] 
SST2Metric: acc=0.5802752293577982, hinge=1.7493385404621788, ce=12.454310452172516
Global test acc: 0.5803
Global epoch 0...
Client 7 execute local training on 4 samples...
Traceback (most recent call last):
  File "FedTuning.py", line 227, in <module>
    optimizer.step()
  File "/root/anaconda3/envs/bbt/lib/python3.8/site-packages/torch/optim/optimizer.py", line 280, in wrapper
    out = func(*args, **kwargs)
  File "/root/anaconda3/envs/bbt/lib/python3.8/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/root/anaconda3/envs/bbt/lib/python3.8/site-packages/transformers/optimization.py", line 468, in step
    denom = exp_avg_sq.sqrt().add_(group["eps"])
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 64.00 MiB (GPU 0; 79.19 GiB total capacity; 78.50 GiB already allocated; 20.81 MiB free; 78.67 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
